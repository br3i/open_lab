<div class="row">
 
  <div class="grid nested-grid">
    <div class="col-12" style="max-width: 700px; margin: auto; padding: 40px; border: 1px solid #e0e0e0; border-radius: 15px; background-color: #fff; box-shadow: 0px 6px 14px rgba(0, 0, 0, 0.1);">
      <!-- Campo de usuario -->
      <div class="formgrid grid" style="margin-bottom: 30px;">
        <div class="field col" style="padding-bottom: 15px;">
          <label for="username" style="font-size: 1.3rem; color: #555; font-weight: 500; margin-bottom: 8px; display: block;">Usuario</label>
          <input id="username" type="text" maxlength="50"
            class="text-base text-color surface-overlay p-3 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full"
            [(ngModel)]="username" placeholder="Ingrese su usuario"
            (keydown.enter)="focusPassword()" 
            style="font-size: 1.1rem; padding: 12px; border: none; border-radius: 0;">
        </div>
      </div>

      <!-- Campo de contraseña con ícono de visibilidad -->
      <div class="formgrid grid" style="padding-bottom: 15px;">
        <div class="field col">
          <label for="password" style="font-size: 1.3rem; color: #555; font-weight: 500; margin-bottom: 8px; display: block;">Contraseña</label>
          <div style="position: relative;">
            <input 
                [type]="showPassword ? 'text' : 'password'" 
                id="password" 
                maxlength="50"
                class="text-base text-color surface-overlay p-3 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full"
                [(ngModel)]="password" placeholder="Ingrese su contraseña" 
                (keydown.enter)="onLogin()"
                style="font-size: 1.1rem; padding: 12px; border: none; border-radius: 0;">
            
            <span (click)="togglePasswordVisibility()" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer;">
              <i [class]="showPassword ? 'pi pi-eye-slash' : 'pi pi-eye'" style="font-size: 1.5rem; color: #666;"></i>
            </span>
          </div>
        </div>
      </div>

      <!-- Botón de inicio de sesión -->
      <div class="formgrid grid" style="margin-top: 30px;">
        <div class="field col text-center">
          <p-button type="button" icon="pi pi-sign-in" label="Ingresar" styleClass="custom-green-button-guardar"
            (click)="onLogin()" [ngStyle]="{ 'font-size': '1.2rem', 'padding': '10px 20px' }"></p-button>
        </div>
      </div>

      <!-- Mensaje para recuperar contraseña -->
      <div class="text-center" style="margin-top: 20px;">
        <button type="button" (click)="showRecoverModal()" style="color: #007bff; background: none; border: none; text-decoration: underline; cursor: pointer; font-size: 1rem;">
          ¿Olvidaste tu contraseña?
        </button>
      </div>
    </div>
  </div>
</div>
<p-dialog 
  header="Recuperar Contraseña" 
  [(visible)]="recoverOptionsModalVisible" 
  [style]="{width: '450px'}" 
  [modal]="true" 
  [closable]="true">

  <div class="modal-content">
    <p style="font-size: 1.1rem; font-weight: bold;">¿Cómo desea recuperar su contraseña?</p>

    <div class="text-center" style="margin-top: 20px;">
      <button 
        pButton 
        type="button" 
        label="Recuperar por Usuario" 
        icon="pi pi-user" 
        (click)="openRecoverByUser()" 
        class="p-button-primary" 
        style="margin-right: 10px;">
      </button>
      <button 
        pButton 
        type="button" 
        label="Recuperar por Correo" 
        icon="pi pi-envelope" 
        (click)="openRecoverByEmail()" 
        styleClass="custom-red-button-cancelar">
      </button>
    </div>
  </div>
</p-dialog>
<!-- Modal de recuperación de contraseña -->
<p-dialog 
  header="Recuperar Contraseña" 
  [(visible)]="recoverModalVisible" 
  [style]="{width: '450px'}" 
  [modal]="true" 
  [closable]="true" 
  (onHide)="resetRecoverData()" 
  [contentStyle]="{'padding': '20px', 'background': '#f9f9f9'}">
  
  <div class="modal-content">
    <!-- Campo para ingresar el usuario -->
    <div class="field" *ngIf="!hiddenEmail">
      <label for="user" style="font-size: 1.1rem; font-weight: bold;">Usuario:</label>
      <input id="user" type="text" [(ngModel)]="recoverUsername" placeholder="Ingrese su usuario" class="p-inputtext p-component p-filled" style="width: 100%; margin-top: 10px;" />
    </div>
    
    <!-- Botón para buscar el correo -->
    <div class="text-right" *ngIf="!hiddenEmail">
      <button pButton type="button" label="Buscar Correo" icon="pi pi-search" (click)="searchUserEmail()" class="p-button-primary" style="margin-top: 20px;"></button>
    </div>

    <!-- Si el correo ya se ha encontrado, lo mostramos -->
    <div *ngIf="hiddenEmail" class="field">
      <label style="font-size: 1.1rem; font-weight: bold;">Correo vinculado:</label>
      <p style="font-size: 1rem; font-weight: bold; color: #555;">{{ hiddenEmail }}</p>
    </div>

    <!-- Botones para enviar código o cancelar (una vez que se encuentra el correo) -->
    <div class="text-right" *ngIf="hiddenEmail">
      <button pButton type="button" label="Enviar Código" icon="pi pi-envelope" (click)="sendVerificationCode()" styleClass="custom-green-button-guardar" style="margin-right: 10px;"></button>
      <button pButton type="button" label="Cancelar" icon="pi pi-times" styleClass="custom-red-button-cancelar" (click)="recoverModalVisible = false; resetRecoverData()"></button>
    </div>
  </div>
</p-dialog>
<!-- Modal para recuperar contraseña por correo -->
<p-dialog 
  header="Recuperar Contraseña por Correo"   
  [(visible)]="recoverByEmailModalVisible" 
  [style]="{width: '450px'}" 
  [modal]="true" 
  [closable]="true" 
  (onHide)="resetRecoverData()">

  <div class="modal-content">
    <!-- Campo para ingresar el correo (oculto si hiddenEmail tiene valor) -->
    <div class="field" *ngIf="!hiddenEmail">
      <label for="email" style="font-size: 1.1rem; font-weight: bold;">Correo Electrónico:</label>
      <input 
        id="email" 
        type="email" 
        [(ngModel)]="recoverEmail" 
        placeholder="Ingrese su correo electrónico" 
        class="p-inputtext p-component p-filled" 
        style="width: 100%; margin-top: 10px;">
    </div>

    <!-- Botones de buscar y cancelar (ocultos si hiddenEmail tiene valor) -->
    <div class="text-right" *ngIf="!hiddenEmail" style="margin-top: 20px;">
      <button 
        pButton 
        type="button" 
        label="Buscar Correo" 
        icon="pi pi-search" 
        (click)="searchEmail()" 
        styleClass="custom-green-button-guardar" 
        style="margin-right: 10px;">
      </button>
      <button 
        pButton 
        type="button" 
        label="Cancelar" 
        icon="pi pi-times" 
        styleClass="custom-red-button-cancelar" 
        (click)="recoverByEmailModalVisible = false; resetRecoverData()">
      </button>
    </div>

    <!-- Mostrar correo vinculado (visible si hiddenEmail tiene valor) -->
    <div *ngIf="hiddenEmail" class="field">
      <label style="font-size: 1.1rem; font-weight: bold;">Correo vinculado:</label>
      <p style="font-size: 1rem; font-weight: bold; color: #555;">{{ hiddenEmail }}</p>
    </div>

    <!-- Botones para enviar código o cancelar (visibles si hiddenEmail tiene valor) -->
    <div class="text-right" *ngIf="hiddenEmail">
      <button 
        pButton 
        type="button" 
        label="Enviar Código" 
        icon="pi pi-envelope" 
        (click)="sendVerificationCode()" 
        styleClass="custom-green-button-guardar" 
        style="margin-right: 10px;">
      </button>
      <button 
        pButton 
        type="button" 
        label="Cancelar" 
        icon="pi pi-times" 
        styleClass="custom-red-button-cancelar" 
        (click)="recoverByEmailModalVisible = false; resetRecoverData()">
      </button>
    </div>
  </div>
</p-dialog>

<p-dialog
  header="Ingrese el Código de Verificación"
  [(visible)]="verificationModalVisible"
  [style]="{ width: '450px' }"
  [modal]="true"
  [closable]="false"
  [contentStyle]="{ padding: '20px', background: '#f9f9f9' }"
>
  <div class="modal-content">
    <div class="field">
      <label for="verificationCode" style="font-size: 1.1rem; font-weight: bold;">Código de Verificación:</label>
      <input
  id="verificationCode"
  type="text"
  [(ngModel)]="verificationCode"
  placeholder="Ingrese el código recibido"
  class="p-inputtext p-component p-filled"
  style="width: 100%; margin-top: 10px;"
/>


    </div>
    <div class="text-right">
      <button
  pButton
  type="button"
  label="Verificar Código"
  icon="pi pi-check"
  (click)="verifyCode();"
  styleClass="custom-green-button-guardar"
  style="margin-right: 10px;"
></button>
      <button
        pButton
        type="button"
        label="Cancelar"
        icon="pi pi-times"
        styleClass="custom-red-button-cancelar"
        (click)="verificationModalVisible = false; resetRecoverData()"
      ></button>
    </div>
  </div>
</p-dialog>


<p-dialog
  header="Cambiar Contraseña"
  [(visible)]="newPasswordModalVisible"
  [style]="{ width: '450px' }"
  [modal]="true"
  [closable]="false"
  [contentStyle]="{ 'padding': '20px', 'background': '#f9f9f9' }"
>
  <div class="modal-content">
    <!-- Nueva Contraseña -->
    <div class="field" style="position: relative;">
      <label for="newPassword" style="font-size: 1.1rem; font-weight: bold;">Nueva Contraseña:</label>
      <div style="position: relative;">
        <input
          [type]="showPassword ? 'text' : 'password'"
          id="newPassword"
          [(ngModel)]="newPassword"
          placeholder="Ingrese su nueva contraseña"
          class="p-inputtext p-component p-filled"
          style="width: 100%; margin-top: 10px;"
          (focus)="mostrarValidaciones = true"
          (blur)="ocultarValidaciones()"
          (input)="validarPassword()"
        />
        <span
          (click)="togglePasswordVisibility()"
          style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer;"
        >
          <i [class]="showPassword ? 'pi pi-eye-slash' : 'pi pi-eye'" style="font-size: 1.5rem; color: #666;"></i>
        </span>
        <!-- Tooltip flotante para validaciones -->
        <div
          *ngIf="mostrarValidaciones && !validacionesCompletas"
          class="password-tooltip"
          style="
            position: absolute;
            top: calc(100% + 5px);
            left: 0;
            width: 100%;
            background-color: #f9f9f9;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 0.5rem;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
            z-index: 1000;
          "
        >
          <ul style="list-style: none; padding: 0; margin: 0;">
            <li [style.color]="validaciones.longitud ? 'green' : 'red'">Mínimo 8 carácteres</li>
            <li [style.color]="validaciones.mayuscula ? 'green' : 'red'">Una letra mayúscula</li>
            <li [style.color]="validaciones.minuscula ? 'green' : 'red'">Una letra minúscula</li>
            <li [style.color]="validaciones.numero ? 'green' : 'red'">Un número</li>
            <li [style.color]="validaciones.caracterEspecial ? 'green' : 'red'">
              Un carácter especial (&#64; $ ! % * ? &)
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Confirmar Contraseña -->
    <div class="field" style="position: relative;">
      <label for="confirmNewPassword" style="font-size: 1.1rem; font-weight: bold;">Confirmar Contraseña:</label>
      <div style="position: relative;">
        <input
          [type]="showPassword ? 'text' : 'password'"
          id="confirmNewPassword"
          [(ngModel)]="confirmNewPassword"
          placeholder="Confirme su nueva contraseña"
          class="p-inputtext p-component p-filled"
          style="width: 100%; margin-top: 10px;"
        />
        <span
          (click)="togglePasswordVisibility()"
          style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer;"
        >
          <i
            [class]="showPassword ? 'pi pi-eye-slash' : 'pi pi-eye'"
            style="font-size: 1.5rem; color: #666;"
          ></i>
        </span>
      </div>
    </div>

    <!-- Botones -->
    <div class="text-right">
      <button
        pButton
        type="button"
        label="Guardar Contraseña"
        icon="pi pi-save"
        (click)="saveNewPassword()"
        styleClass="custom-green-button-guardar"
        style="margin-right: 10px;"
      ></button>
      <button
        pButton
        type="button"
        label="Cancelar"
        icon="pi pi-times"
        styleClass="custom-red-button-cancelar"
        (click)="newPasswordModalVisible = false; resetRecoverData()"
      ></button>
    </div>
  </div>
</p-dialog>



<p-toast></p-toast>
