<div class="dashboard-fundacion p-4">
    <h2 class="text-2xl font-bold mb-4">Dashboard de Indicadores</h2>

    <!-- FILTROS MULTISELECCIÓN -->
    <p-card styleClass="mb-4">
        <ng-template pTemplate="title">
            Filtros Globales
        </ng-template>

        <div class="p-fluid grid formgrid">
            <div class="field col-12 md:col-2">
                <label for="anio">Años</label>
                <p-multiSelect inputId="anio"
                               [options]="filtrosDisponibles.anios"
                               [(ngModel)]="filtrosSeleccionados.anios"
                               placeholder="Seleccione uno o varios"
                               display="chip">
                </p-multiSelect>
            </div>

            <div class="field col-12 md:col-2">
                <label for="eje">Ejes</label>
                <p-multiSelect inputId="eje"
                               [options]="filtrosDisponibles.ejes"
                               [(ngModel)]="filtrosSeleccionados.ejes"
                               placeholder="Seleccione uno o varios"
                               display="chip">
                </p-multiSelect>
            </div>

            <div class="field col-12 md:col-2">
                <label for="fundacion">Fundaciones</label>
                <p-multiSelect inputId="fundacion"
                               [options]="filtrosDisponibles.fundaciones"
                               [(ngModel)]="filtrosSeleccionados.fundaciones"
                               placeholder="Seleccione uno o varios"
                               display="chip">
                </p-multiSelect>
            </div>

            <div class="field col-12 md:col-3">
                <label for="indicador">Indicadores / Sub-Indicadores</label>
                <p-multiSelect inputId="indicador"
                               [options]="filtrosDisponibles.indicadores"
                               [(ngModel)]="filtrosSeleccionados.indicadores"
                               placeholder="Seleccione uno o varios"
                               display="chip">
                </p-multiSelect>
            </div>

            <div class="field col-12 md:col-3">
                <label for="mes">Meses</label>
                <p-multiSelect inputId="mes"
                               [options]="filtrosDisponibles.meses"
                               [(ngModel)]="filtrosSeleccionados.meses"
                               placeholder="Seleccione uno o varios"
                               display="chip">
                </p-multiSelect>
            </div>
        </div>

        <ng-template pTemplate="footer">
            <div class="flex flex-wrap gap-2 justify-content-end">
                <button pButton type="button" label="Limpiar" icon="pi pi-times" class="p-button-outlined" (click)="limpiarFiltros()"></button>
                <button pButton type="button" label="Aplicar Filtros" icon="pi pi-check" (click)="aplicarFiltros()"></button>

                <!-- ===== BOTÓN DE DESCARGA ACTUALIZADO ===== -->
                <!-- Llama al método para abrir el modal en lugar de p-menu -->
                <button pButton type="button" label="Descargar" icon="pi pi-download" class="p-button-success" (click)="abrirModalDescarga()"></button>
            </div>
        </ng-template>
    </p-card>

    <!-- GRÁFICOS -->
    <div class="grid">
        <div class="col-12 md:col-4">
            <p-card>
                <div class="chart-container">
                    <canvas #chartTotalPorEje></canvas>
                </div>
            </p-card>
        </div>
        <div class="col-12 md:col-8">
            <p-card>
                <div class="chart-container">
                    <canvas #chartEvolucionMensual></canvas>
                </div>
            </p-card>
        </div>
        <div class="col-12 md:col-6">
            <p-card>
                <div class="chart-container">
                    <canvas #chartComparativoFundacion></canvas>
                </div>
            </p-card>
        </div>
        <div class="col-12 md:col-6">
            <p-card>
                <div class="chart-container">
                    <canvas #chartProgresoMeta></canvas>
                </div>
            </p-card>
        </div>
    </div>
</div>

<!-- ===== MODAL DE DESCARGA PERSONALIZADO ===== -->
<!-- Se muestra condicionalmente con *ngIf -->
<div class="modal-overlay" *ngIf="mostrarModalDescarga" (click)="cerrarModalDescarga()">
    <!-- El (click) en el contenido detiene la propagación para que no se cierre al hacer clic dentro -->
    <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h3 class="modal-title">Opciones de Descarga</h3>
            <button class="modal-close-button" (click)="cerrarModalDescarga()" aria-label="Cerrar">&times;</button>
        </div>
        <div class="modal-body">
            <!-- Usamos pButton aquí para mantener el estilo de PrimeNG -->
            <button pButton type="button" (click)="descargarComoPPTX()" label="PowerPoint (.pptx)" icon="pi pi-file-powerpoint" class="p-button-danger p-button-raised w-full mb-3"></button>
            <button pButton type="button" (click)="descargarComoExcel()" label="Excel (.xlsx)" icon="pi pi-file-excel" class="p-button-success p-button-raised w-full"></button>
        </div>
    </div>
</div>
