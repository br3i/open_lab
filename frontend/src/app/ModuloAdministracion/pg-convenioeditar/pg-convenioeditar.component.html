<div class="card separador-componentes">
    <p-toolbar>
        <div class="p-toolbar-group-center">
            <p>{{ idTipoDonante === 1 ? 'DATOS DEL CONVENIO - PERSONA NATURAL' : 'DATOS DEL CONVENIO - PERSONA JURÍDICA' }}</p>
        </div>
    </p-toolbar>

 
    <form [formGroup]="convenioForm">
        <!-- Datos generale sdel convenio -->
        <div class="flex flex-column gap-2 mt-3">
            <label for="resolucion">Resolución:</label>
            <input id="resolucion" pInputText formControlName="resolucion">
        </div>
        <br>
        <div class="form-row">

            <div class="form-field  flex flex-column gap-2 mt-3">
                <label for="titulo">Título del Convenio:</label>
                <textarea id="titulo" [value]="datosConvenio?.ouconvenio_strtitulo"  pInputText formControlName="titulo" rows="4"></textarea>
            </div>

            <div class="form-field ">
                <label for="objetivo">Objetivo:</label>
                <textarea id="objetivo" [value]="datosConvenio?.ouconvenio_strobjetivo" pInputText formControlName="objetivo" rows="4"></textarea>
            </div>
        </div>

        <div class="form-row">
            <div class="form-field">
                <div class="form-row mt-3 align-items-center">
                    <div class="col-auto">
                        <label for="tipoConvenio" class="form-label">Tipo Convenio:</label>
                    </div>
                    <div class="col">
                        <select formControlName="strTipoConvenio"
                            class="select-sm w-full text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round outline-none focus:border-primary"
                            style="appearance: auto">
                            <option *ngFor="let tipoconvenio of listadoTipoConvenio"
                                [ngValue]="tipoconvenio.idtipoconvenio">
                                {{tipoconvenio.tipoconvenio_strnombre}}</option>
                        </select>
                    </div>
                </div>

                <div class="form-field">
                    <!-- Lista para seleccionar al coordinador -->
                    <div class="form-row mt-3 align-items-center">
                        <div class="col-auto">
                            <label for="coordinadoresBar" class="form-label">Seleccionar coordinador del FUNDACIÓN FAVORITA:</label>
                        </div>
                        <div class="col">
                            <p-autoComplete formControlName="coordinadorSeleccionadoBar" [dropdown]="true"
                                [showClear]="true" [suggestions]="coordinadoresFiltradosBar"
                                (completeMethod)="filtrarCoordinadoresBar($event)"
                                (onSelect)="onCoordinadorSeleccionado($event)" [field]="'nombreCompleto'"
                                placeholder="Nombre o Apellido">
                            </p-autoComplete>
                        </div>
                    </div>
                    <!-- Primera fila: Nombres y Apellidos -->
                    <div class="form-row mt-3">
                        <div class="col">
                            <label class="form-label" for="nombres">Nombres:</label>
                            <input type="text" id="nombres"
                                [value]="convenioForm.get('coordinadorSeleccionadoBar')?.value?.nombres || datosConvenio?.ouconvenio_strobjetivo "
                                class="p-inputtext" disabled placeholder="Nombres">
                        </div>
                        <div class="col">
                            <label for="apellidos">Apellidos:</label>
                            <input type="text" id="apellidos"
                                [value]="convenioForm.get('coordinadorSeleccionadoBar')?.value?.apellidos || ''"
                                class="p-inputtext" disabled placeholder="Apellidos">
                        </div>

                        <div class="col">
                            <label for="cedula">Cédula:</label>
                            <input type="text" id="cedula"
                                [value]="convenioForm.get('coordinadorSeleccionadoBar')?.value?.cedula || ''"
                                class="p-inputtext" disabled placeholder="Cédula">
                        </div>
                        <div class="col">
                            <label for="celular">Celular:</label>
                            <input id="celular" type="text" maxlength="10" oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                                [value]="convenioForm.get('coordinadorSeleccionadoBar')?.value?.celular || ''"
                                class="p-inputtext" disabled placeholder="Celular">
                        </div>
                    </div>
                </div>

                <div class="form-row mt-3">
                    <div class="col">
                        <label for="fechaInicio">Fecha de Inicio: </label>
                        <p-calendar id="fechaInicio" formControlName="fechaInicio" [showIcon]="true" [minDate]="minDate"
                            dateFormat="dd/mm/yy" (onSelect)="calcularFechaFin()">
                        </p-calendar>
                    </div>

                    <div class="col">
                        <label for="anos">Años: </label>
                        <input id="anos" type="number" pInputText formControlName="anos" (input)="calcularFechaFin()">
                    </div>

                    <div class="col">
                        <label for="meses">Meses: </label>
                        <input id="meses" type="number" pInputText formControlName="meses" (input)="calcularFechaFin()">
                    </div>

                    <div class="col">
                        <label for="fechaFin">Fecha de Fin: </label>
                        <p-calendar id="fechaFin" formControlName="fechaFin" [readonlyInput]="true"
                            dateFormat="dd/mm/yy" [showIcon]="true"></p-calendar>
                    </div>
                </div>
            </div>
        </div>

        <p-toolbar>
            <div class="p-toolbar-group-center">
                <p>INFORMACIÓN DEL DONANTE</p>
            </div>
        </p-toolbar>


        <!-- Mostra Informacion de la empresa -->
        <div class="form-field">
            <div class="form-row mt-3" *ngIf="idTipoDonante === 2 && datosEmpresa">
                <div class="col">
                    <label class="form-label" for="nombres">Razón Social::</label>
                    <input type="text" id="nombres" [value]="datosEmpresa?.empresa_strnombre" disabled
                        class="p-inputtext" placeholder="Nombres">
                </div>
                <div class="col">
                    <label class="form-label" for="ruc">RUC:</label>
                    <input type="text" id="ruc" [value]="datosEmpresa?.strdocumento" disabled class="p-inputtext"
                        placeholder="RUC">
                </div>
                <div class="col">
                    <label class="form-label" for="correo">Correo Electrónico:</label>
                    <input type="text" id="correo" [value]="datosEmpresa?.empresa_strcorreo1" disabled
                        class="p-inputtext" placeholder="Correo">
                </div>
                <div class="col">
                    <label class="form-label" for="celular">Celular:</label>
                    <input type="text" id="celular" [value]="datosEmpresa?.empresa_strcelular1" disabled
                        class="p-inputtext" placeholder="Celular">
                </div>
            </div>
        </div>



        <div class="form-field">
            <!-- Primera fila: Nombres y Apellidos -->
            <div class="form-row mt-3">
                <div class="col">
                    <label class="form-label" for="nombres">Nombres:</label>
                    <input type="text" id="nombres1"
                        [value]="datosRepresentanteEmpresa?.nombres"
                        class="p-inputtext" disabled placeholder="Nombres">
                </div>
                <div class="col">
                    <label for="apellidos">Apellidos:</label>
                    <input type="text" id="apellidos1"
                        [value]="datosRepresentanteEmpresa?.apellidos"
                        class="p-inputtext" disabled placeholder="Apellidos">
                </div>

                <div class="col">
                    <label for="cedula">Cédula:</label>
                    <input type="text" id="cedula1"
                        [value]="datosRepresentanteEmpresa?.documento"
                        class="p-inputtext" disabled placeholder="Cédula">
                </div>
                <div class="col">
                    <label for="celular">Celular:</label>
                    <input type="text" id="celular1"
                        [value]="datosRepresentanteEmpresa?.celular1"
                        class="p-inputtext" disabled placeholder="Celular">
                </div>
            </div>
        </div>
        <!-- Seleccionar Persona 
            <div class="form-field" *ngIf="idTipoDonante === 2">
                
 
                <div class="form-row mt-3">
                    <div class="col">
                        <label class="form-label" for="nombres">Nombre:</label>
                        <input type="text" id="nombres" [value]="personaSeleccionada.ounombres" disabled
                            class="p-inputtext" placeholder="Nombre">
                    </div>
                    <div class="col">
                        <label class="form-label" for="cedula">Cédula:</label>
                        <input type="text" id="cedula" [value]="personaSeleccionada.oucedula" disabled
                            class="p-inputtext" placeholder="Cédula">
                    </div>
                </div>
            </div>-->


        <p-toolbar>
            <div class="p-toolbar-group-center">
                <p>DOCUMENTOS</p>
            </div>
        </p-toolbar>




        <div class="centered-content">
            <span class="centered-text">Documentos del Convenio</span>
            <p-button icon="pi pi-plus" (click)="ModalAgregarArchivo()" label="Añadir Documento"></p-button>
        </div>

        <!-- Modal para subir documento -->
        <p-dialog header="Subir Documentos" [(visible)]="modalArchivosVisible" [modal]="true" [closable]="true"
            [style]="{ width: '600px' }" class="custom-dialog">
            <div class="modal-header">
                <h3 class="modal-title">Subir Documento</h3>
                <p class="modal-subtitle">Proporcione los detalles del documento</p>
            </div>

            <form [formGroup]="formGroup" class="form-container">
                <!-- Nombre del Documento -->
                <div class="field-row">
                    <div class="field">
                        <label for="nombreDocumento" class="field-label">Nombre del Documento *</label>
                        <input id="nombreDocumento" formControlName="nombreDocumento"
                            placeholder="Ejemplo: Contrato de Servicio" class="p-inputtext p-component input-text" />
                    </div>
                </div>

                <!-- Descripción -->
                <div class="field-row">
                    <div class="field">
                        <label for="descripcionDocumento" class="field-label">Descripción (opcional)</label>
                        <textarea id="descripcionDocumento" formControlName="descripcionDocumento"
                            placeholder="Añada una descripción breve" class="p-inputtextarea p-component textarea"
                            rows="3"></textarea>
                    </div>
                </div>

                <!-- Subir Archivo -->
                <div class="field-row">
                    <div class="field">
                        <label for="archivo" class="field-label">Subir Archivo *</label>
                        <div class="upload-container">
                            <input id="archivo" type="file" class="input-file" (change)="seleccionarArchivo($event)" />
                            <p class="upload-text">
                                <i class="pi pi-upload"></i> Arrastre y suelte un archivo aquí o haga clic para subir
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Botones -->
                <div class="button-row">
                    <p-button severity="danger" label="Cancelar" icon="pi pi-times"
                        (click)="ModalCerrar('ModalDocumentos')"></p-button>
                    <button pButton label="Enviar" class="p-button-success submit-button" type="button"
                        (click)="agregarDocumento()"></button>
                </div>
            </form>
        </p-dialog>


        <p-table *ngIf="documentos.length > 0" [value]="documentos" [paginator]="true" [rows]="5" class="mt-3">
            <ng-template pTemplate="header">
                <tr>
                    <th>Número de Documento</th>
                    <th>Nombre del Documento</th>
                    <th>Descripción</th>
                    <th>Acciones</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-documento let-i="rowIndex">
                <tr>
                    <td>{{ i + 1 }}</td>
                    <td>{{ documento.conv_anexo_strconvenioanexo }}</td>
                    <td>{{ documento.conv_anexo_strdescripcionanexo }}</td>
                    <td>
                        <button type="button" pButton icon="pi pi-eye" (click)="visualizarDocumento(documento)"
                            class="p-button-info"></button>
                        <button type="button" pButton icon="pi pi-trash" (click)="eliminarDocumento(i)"
                            class="p-button-danger"></button>
                    </td>
                </tr>
            </ng-template>
        </p-table>

        <div class="flex flex-column gap-2 mt-3">
            <label for="observaciones">Observaciones:</label>
            <textarea id="observaciones" [value]="datosConvenio?.ouconvenio_strobservacion" pInputText formControlName="observaciones" rows="5" cols="30">
              </textarea>
        </div>


        <div class="flex flex-column gap-2 mt-3">
            <button pButton type="button" label="Guardar Cambios" styleClass="custom-green-button-guardar"
                (click)="guardarCambios()"></button>
        </div>
    </form>


    <p-confirmDialog></p-confirmDialog>
    <p-toast></p-toast>
</div>